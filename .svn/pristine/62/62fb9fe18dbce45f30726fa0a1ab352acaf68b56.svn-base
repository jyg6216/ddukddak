<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<style>
/* 모달 스타일 */
.modal {
	display: none; /* 초기에는 모달을 감춤 */
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5); /* 배경에 어둡게 투명한 검정색 레이어 생성 */
	justify-content: center;
	align-items: center;
}

.modal-content {
	background-color: #fefefe;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
	max-width: 600px;
	text-align: center;
}

/* 닫기 버튼 스타일 */
.close {
	color: #aaa;
	float: right;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}

/* 풀캘린더 스타일 */
.cal {
	width: 50%;
	min-height: 500px;
	margin: 20px 50px;
}

#calendar2 {
	width: 500px;
	margin-left: 20px;
}
</style>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<!-- sweetalert -->
<script src="/resources/fullcalendar-6.1.10/sweetalert2.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<!-- 풀캘린더 -->
<div id="calendar1" class="cal"></div>
<div id="calendar2" class="cal"></div>

<!-- 일정 추가하는 모달 창 -->
<div id="myModal" class="modal">
	<div class="modal-content">
		<span class="close" id="closeModal">&times;</span>
		<label for="eventStart">시작 일시:</label>
			<input type="date" id="eventStart">
		<label for="eventEnd">종료 일시:</label>
			<input type="date" id="eventEnd">
		<label for="eventContent">일정 내용:</label>
			<input type="text" id="eventContent">
		<button id="realSaveEvent" onclick="modalSave()">저장</button>
	</div>
</div>


<script>
let calendarEl = $("#calendar1")[0];
let calendar1;

	document.addEventListener('DOMContentLoaded', function() {

		
		let start = $("#eventStart").val();
		let end = $("#eventEnd").val();
		let content = $("#eventContent").val();
		

		calendar1 = new FullCalendar.Calendar(calendarEl, {
			// 한국어 설정
			locale : 'ko',
			// 화면에 맞게 높이 재설정
			expandRows : true,
			// 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
			initialView : 'dayGridMonth',
			// 날짜를 클릭했을 시 이벤트
			dateClick : function(info) {
				console.log(info.dateStr); // 2023-12-07
			},
			// 날짜를 선택하면 Day 캘린더나 Week 캘린더로 링크
			navLinks : true,
			// 버튼 만들기
			customButtons : {
				calButton : {
					text : "캘린더"
				},
				saveEvent : {
					text : "일정 추가 +",
					click : function() {
						// 모달 열기
						$("#myModal").css("display", "block");
						// 'X'버튼으로 모달 닫기
						document.getElementById('closeModal').onclick = function() {
							document.getElementById('myModal').style.display = 'none';
						}
						// 모달 영역 외 클릭 시 모달 닫기
						window.onclick = function(event) {
							var modal = $("#myModal");
							if (event.target == modal[0]) {
								modal.css("display", "none");
							}
						}
						
					}
				}
			},
			// 해더에 표시할 툴바
			headerToolbar : {
				left : 'calButton prev,next',
				center : 'title',
				right : 'today saveEvent'
			},

			// 캘린더에서 드래그로 이벤트를 생성
			select : function(arg) {
				let title = prompt('Event Title:');
				if (title) {
					calendar1.addEvent({
						title : title,
						start : arg.start,
						end : arg.end,
						allDay : arg.allDay
					})
				}
				calendar1.unselect();
			}
		// 이벤트
		});
		calendar1.render();
	});

	let calendarE2 = $("#calendar2")[0];
	
	const calendar2 = new FullCalendar.Calendar(calendarE2, {
		// 한국어 설정
		locale : 'ko',
		// 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
		initialView : 'timeGridDay',
		// Day 캘린더에서 시작 시간
		slotMinTime : '09:00',
		// Day 캘린더에서 종료 시간
		slotMaxTime : '21:00',
		// 현재 시간 마크
		nowIndicator : true,
		// 해더에 표시할 툴바
		headerToolbar : {
			left : 'prev,next',
			center : 'title',
			right : 'today'
		},
		// 캘린더에서 드래그로 이벤트를 생성
		select : function(arg) {
			let title = prompt('Event Title:');
			if (title) {
				calendar2.addEvent({
					title : title,
					start : arg.start,
					end : arg.end,
					allDay : arg.allDay
				})
			}
			calendar2.unselect();
		}
	});
	calendar2.render();

	// 모달창 입력값 확인
	function modalSave(){
		let start = $("#eventStart").val();
		let end = $("#eventEnd").val();
		let content = $("#eventContent").val();
		
		let eventData = {
				start : start,
				end : end,
				title : content
		};
		
		//빈값입력시 오류
		  if (eventData.title == "" || eventData.start == "" || eventData.end == "") {
			alert("입력이 부족합니다. 모든 항목을 입력해주세요.");
			return;
		  } else if ($("#start").val() > $("#end").val()) {
		    //끝나는 날짜가 시작하는 날짜보다 값이 크면 안됨
		    alert("시간을 잘못 입력 하셨습니다.");
		  } else {
		    // 이벤트 추가
		    calendar1.addEvent(eventData);
		    $("#eventStart").val("");
		    $("#eventEnd").val("");
		    $("#eventContent").val("");
		    $("#myModal").css("display", "none");
		    calendar1.render();
		  }
		
	}
</script>