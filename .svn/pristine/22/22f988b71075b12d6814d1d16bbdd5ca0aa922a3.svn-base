<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
.aside-ams-patient{
	width: 196px;
	border-radius: 16px 0px 0px 16px;
	background: var(--bg-02, #DBF2F4);
	height: 56px;
	border-right: 4px solid var(--ci-01, #0ABAB5);
	margin-left: 4px;
	color: var(--ci-01, #0ABAB5);
}

.patient-detail {
	width: 892px;
	height: 100%;
	flex-shrink: 0;
}	
.patient-note {
	width: 360px;
}

.search{
	background-image: url(/resources/images/Search.png);
	background-repeat: no-repeat;
	background-position: 252px center;
	width: 292px;
	height: 48px;
}

.record-input{
	background-image: url(/resources/images/Arrowupward.png);
	background-repeat: no-repeat;
	background-position: 272px center;
	width: 312px;
	height: 48px;
}

.dduk-vertical-line {
	height: 642px;
	margin-top: -18px;
	margin-left: 272px;
}

hr{
	margin: -8px 0 16px -16px;
	background: var(--border, #EBEFF0);
	height: 1px;
}

.record-content-fr {
	height: 343px;
}

.dduk-login-input {
	width: 288px;
	height: 40px;
	flex-shrink: 0;
}

.modal-content{
	width: 680px;
}

.modal-body {
	padding: 48px; 
}

.search-btn {
	margin-left:8px; 
	padding: 4px 14px; 
	border-radius: 12px; 
	height: 38px;
}

.search-btn:hover {
	background: var(--ci-01, #0ABAB5);
}

.form-check {
	display: flex;
    gap: 40px;
    padding: 8px 16px;
    margin-top: 8px;
    margin-left: 16px;
}

.dduk-row {
	gap: 16px;
}

</style>
<script>
$(document).ready(function() {
	 $('.aside-ams-patient').find('svg').find('path').attr('fill', '#0ABAB5');
	
	 var strPaName=( $('.paName').val()).substring(0,8);
	
	 const createPatientModal = document.getElementById('createPatientModal');
	 const createPatientInput = document.getElementById('createPatientInput');
	 
	 
	 
	 
	 $('#createPatientBtn').on("click", function(){
		console.log("눌리나?"); 
		
	 });
	 
	 
	 $('#inner-tab1').click(function(){
		$('#diag-scroll').attr('style', 'display: block' );
		$('#Adm-scroll').attr('style', 'display: none');
		$('#inner-tab1').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab2').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
	 });
	 
	 $('#inner-tab2').click(function(){
		$('#diag-scroll').attr('style', 'display: none' );
		$('#Adm-scroll').attr('style', 'display: block');
		$('#inner-tab1').attr('style', 'border-bottom: 0px solid var(--ci-01, #0ABAB5)' );
		$('#inner-tab2').attr('style', 'border-bottom: 3px solid var(--ci-01, #0ABAB5)' );
	 });
	 
	 $(document).on("click", "#btnAddPatient",function(){
		 
		 $("#createPatient").find(":input[required]").each(function () {

		        if ($(this).val() === "") {
		            $(this).css("border", "2px solid red");
		            return
		        } else {
		            $(this).css("border", "");
		        }

		    });
		 
		 let createPatientFrm = $('#createPatient')[0];
		 
		 let formData= new FormData(createPatientFrm);
		 
		 
		 let data = {};
		 formData.forEach((value, key) => data[key] = value);
		

		$.ajax({
			url: "/common/patientCreatePost",
			type:"post",
			data: JSON.stringify(data),
			dataType:"json",
			contentType:"application/json;charset:UTF-8",
			beforeSend : function(xhr) {
				xhr.setRequestHeader("${_csrf.headerName}",
						"${_csrf.token}");
			}
		}).done((rst) => {
			console.log(rst);
		}).fail((xhr) => {
			console.log(xhr);
		})
		 
	 });
	 
	 
});
</script>
<html>
	<div class="dduk-body-border patient-list">
		<div>
			<div class="dduk-title-area">
				<h2>환자 목록</h2>
				<svg id="createPatientInput" type="button" data-bs-toggle="modal" data-bs-target="#createPatientModal"  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
					<g clip-path="url(#clip0_142_1638)">
						<path d="M18 13H13V18C13 18.55 12.55 19 12 19C11.45 19 11 18.55 11 18V13H6C5.45 13 5 12.55 5 12C5 11.45 5.45 11 6 11H11V6C11 5.45 11.45 5 12 5C12.55 5 13 5.45 13 6V11H18C18.55 11 19 11.45 19 12C19 12.55 18.55 13 18 13Z" fill="#8D9EA5"/>
					</g>
					<defs>
					<clipPath id="clip0_142_1638">
						<rect width="24" height="24" fill="white"/>
					</clipPath>
					</defs>
				</svg>
			</div>
			<div class="dduk-x-pd8">
				<table class="patient-list-table">
					<tr class="tr-padding">
						<th class="td-padding gray-text" style="width:40px;">No</th>
						<th class="td-padding gray-text paName" style="width:120px;">이름</th>
						<th class="td-padding gray-text">생년월일</th>
					</tr>
					<c:forEach var="patient" items="${patientVOList}" varStatus="status">
						<tr class="tr-padding">
							<td class="td-padding">
								${status.count}
							</td>
							<td height="48px" class="td-padding">
								<c:choose>
							        <c:when test="${fn:length(patient.paName) gt 9}">
							        <c:out value="${fn:substring(patient.paName, 0, 7)}">
							        </c:out>...</c:when>
							        <c:otherwise>
							        <c:out value="${patient.paName}">
							        </c:out></c:otherwise>
								</c:choose>
							</td>
							<td class="td-padding">
								<c:choose>
							        <c:when test="${fn:substring(patient.paReg, 0, 1) gt 0}">
							        19<c:out value="${fn:substring(patient.paReg, 0, 2)}">
							        </c:out></c:when>
							        <c:otherwise>
							        20<c:out value="${fn:substring(patient.paReg, 0, 2)}">
							        </c:out></c:otherwise>
								</c:choose>
								-${fn:substring(patient.paReg, 2, 4)}-${fn:substring(patient.paReg, 4, 6)}
							</td>
						</tr>
					</c:forEach>
				</table>
			</div>	
		</div>
		<input class="search dduck-input" placeholder="환자 이름을 검색해주세요">
	</div>
	
	<div class="dduk-body-border patient-detail"  style="position: relative;">
		<div class="dduk-title-area">
			<div class="d-flex align-items-center">
				<h2>노르망디 크롱스 블레이드</h2>
				<span class="gray-text mar-b-8 mar-l-8">남, 39세(1983-12-05)</span>
			</div>
			<div>
				<div class="d-flex patient-info">
					<div>
						<span class="gray-text">신장&nbsp;&nbsp;</span>180.6cm
					</div>
					<div>
						<span class="gray-text">체중&nbsp;&nbsp;</span>78.8kg
					</div>
					<div>
						<span class="gray-text">체온&nbsp;&nbsp;</span>36.8°C</div>
					</div>
			</div>
			<button class="dduk-btn-normal">상세보기</button>
		</div>
		<hr style="width: 892px;">
		<div class="d-flex">
			<div class="dduk-history">
				<div style="height: 520px;">
					<div class="subTitle-margin">
						<div class="dduk-row spa-betw">
							<div class="inner-tab" id="inner-tab1" style="border-bottom: 3px solid var(--ci-01, #0ABAB5);">
								<h3>진료 이력</h3>
							</div>
							<div class="inner-tab" id="inner-tab2">
								<h3>입원 이력</h3>
							</div>
						</div>
					</div>
					<div class="history-scroll" id="diag-scroll">
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
					</div>
					
					<div class="history-scroll" id="Adm-scroll" style="display: none;">
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">입원 나오나?(수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
						<div class="dduk-history-list">
							<div class="history-array">	
								<div>
									<div class="history-title">내원·2023-11-22 (수)</div>
									<div>담당의 이은솔</div>
								</div>
								<button class="dduk-btn-active" style="height: 32px;"> 
									수납필요
								</button>
							</div>
							<div class="d-flex history-btn-list">
								<span class="history-btn">진료</span>
								<span class="history-btn">검사</span>
								<span class="history-btn">치료</span>
								<span class="history-btn">처방</span>
							</div>
						</div>
					</div>
					
				</div>
				<hr style="width: 289px;">
				<div style="height: 239px;">
					<div class="spa-betw">
						<div class="subTitle-margin">
							<h3>문서 발급</h3>
						</div>
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
							<g clip-path="url(#clip0_142_1806)">
							<path d="M18 13H13V18C13 18.55 12.55 19 12 19C11.45 19 11 18.55 11 18V13H6C5.45 13 5 12.55 5 12C5 11.45 5.45 11 6 11H11V6C11 5.45 11.45 5 12 5C12.55 5 13 5.45 13 6V11H18C18.55 11 19 11.45 19 12C19 12.55 18.55 13 18 13Z" fill="#8D9EA5"/>
							</g>
							<defs>
							<clipPath id="clip0_142_1806">
							<rect width="24" height="24" fill="white"/>
							</clipPath>
							</defs>
						</svg>
					</div>
					<div class="gap-ver-16 p-8">
						<div class="spa-betw"><span class="text16">진단서</span><button class="dduk-btn-normal">발급하기</button></div>
						<div class="spa-betw"><span class="text16">소견서</span><button class="dduk-btn-disabled">발급완료</button></div>
						<div class="spa-betw"><span class="text16">처방전</span><button class="dduk-btn-danger">발급불가</button></div>
					</div>
				</div>
			</div>
			<div class="patient-record">
				<div class="subTitle-margin">
					<h3>진료 기록</h3>
				</div>
				<div class="gap-ver-16">
					<div class="gap-row-16 w-100">
						<div class="dduk-inner-border record-content-fr" style="width:284px;">
							<h3 class="m-8">진료 내용</h3>
						</div>
						<div class="dduk-inner-border record-content-fr" style="width:272px;">
							<h3 class="m-8">이미지</h3>
							<div class="record-img-scroll">
									<img class="record-img" src="/resources/images/images1.png"/>
									<img class="record-img" src="/resources/images/images1.png"/>
									<img class="record-img" src="/resources/images/images1.png"/>
									<img class="record-img" src="/resources/images/images1.png"/>
									<img class="record-img" src="/resources/images/images1.png"/>
									<img class="record-img" src="/resources/images/images1.png"/>
							</div>
						</div>
					</div>
					<div class="dduk-inner-border w-100" style="height: 320px;">
						<h3>오더 내역 </h3>
					</div>
				</div>
			</div>
		</div>
		
	</div>
	
	<div class="dduk-body-border patient-note">
		<div class="subTitle-margin mar-b-8">
			<h3>환자 기록</h3>
		</div>
		<div class="spa-betw flex-d-col" style="height: 760px;">
			<div class="gap-ver-32 w-100 p-8">
				<div>
					<div class="d-flex">
						<img class="record-profile-img" src="/resources/images/Ellipse12.png"/>
						<div>
							<div>원무과 김한나</div>
							<div class="gray-text">2023-11-21(화) 12:33:42</div>
						</div>
					</div>
					<div class="d-flex justify-content-end">
						<div class="patient-record-chat mar-t-8">
							상시 복용 약품 없음 확인.
						</div>
					</div>
				</div>
				<div>
					<div class="d-flex">
						<img class="record-profile-img" src="/resources/images/Ellipse14.png"/>
						<div>
							<div>의사 전영균</div>
							<div class="gray-text">2023-11-21(화) 16:55:16</div>
						</div>
					</div>
					<div class="d-flex justify-content-end">
						<div class="patient-record-chat mar-t-8">
							진단서 발급, <br/>
							금주 금요일에 예약 잡아주세요.
						</div>
					</div>
				</div>
				<div>
					<div class="d-flex">
						<img class="record-profile-img" src="/resources/images/Ellipse13.png"/>
						<div>
							<div>원무과 이수정</div>
							<div class="gray-text">2023-11-21(화) 16:55:16</div>
						</div>
					</div>
					<div class="d-flex justify-content-end">
						<div class="patient-record-chat mar-t-8">
							샤이니 콘서트 예약 바랍니다.
						</div>
					</div>
				</div>
			<hr style="width:360px; margin-left: -24px;">
			<div class="gray-text" style="margin-top: -44px; margin-left: 102px;">2023-11-2(수)</div>
			</div>
			<input class="record-input dduck-input" placeholder="환자 기록을 추가해주세요">
		</div>
	</div>
	
	
	
	<!-- 	환자 추가 모달	 -->
	<div id="createPatientModal" class="modal" tabindex="-1" >
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title">환자 추가</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	      	<form id="createPatient">
				<div class="login-form-content">
							<div class="dduk-row">
								<div class="dduk-login-d">
									<div class="login-input-label">성명</div> 
									<input id="paName" name="paName" class="dduk-login-input" type="text" required/>
								</div>
								<div class="dduk-login-d">
									<div class="login-input-label">성별</div>
									<div class="form-check" role="group">
										<span>
											<input type="radio" id="paSex1" name="paSex" class="form-check-input" value="남" required/>
											<label for="paSex1">남성</label>
										</span>
										<span>
											<input type="radio" id="paSex2" name="paSex" class="form-check-input" value="여" required/>
											<label for="paSex2">여성</label>
										</span>
									</div>
								</div>
							</div>
							<div class="dduk-login-d">
								<div class="login-input-label">주민번호</div> 
								<input id="paReg" name="paReg" class="dduk-login-input" type="text" style="width: 584px;" required/>
							</div>
							
							<div style="margin: 12px 0px;">
								<div class="dduk-row">
									<div class="dduk-login-d"  style="margin-bottom: 0px;">
										<div class="login-input-label">주소</div>
										<div class="d-flex" style="align-items: baseline">
											<input type="text" id="pzZip" name="pzZip" class="dduk-login-input" style="width: 203px;" required/>
											<button type="button" class="dduk-btn-nomal search-btn" id="btnPost" >우편번호 찾기</button>
										</div>
									</div>
								</div>
								<div class="dduk-row">
									<div class="dduk-login-d">
										<input id="paAdd1" name="paAdd1" class="dduk-login-input" type="text" required/>
									</div>
									<div class="dduk-login-d">
										<input id="paAdd2" name="paAdd2" class="dduk-login-input" type="text" placeholder="상세주소" required/>
									</div>
								</div>
							</div>
							
							<div class="dduk-row">
								<div class="dduk-login-d">
									<div class="login-input-label">키</div>
									<input id="paHeight" name="paHeight" class="dduk-login-input" type="text" required/>
								</div>
								<div class="dduk-login-d">
									<div class="login-input-label">몸무게</div>
									<input id="paWeight" name="paWeight" class="dduk-login-input" type="text" required/>
								</div>
							</div>
							
							
							
							<div class="dduk-row">
								<div class="dduk-login-d">
									<div class="login-input-label">연락처</div> 
									<input id="paPh" name="paPh" class="dduk-login-input" type="text" required/>
								</div>
								<div class="dduk-login-d">
									<div class="login-input-label">혈액형</div> 
									<div class="form-check" role="group">
										<span>
											<input type="radio" id="paBldType1" name="paBldType" class="form-check-input" value="A" required />
											<label for="paBldType1">A</label>
										</span>
										<span>
											<input type="radio" id="paBldType2" name="paBldType" class="form-check-input" value="B" required/>
											<label for="paBldType2">B</label>
										</span>
										<span>
											<input type="radio" id="paBldType3" name="paBldType" class="form-check-input" value="AB" required/>
											<label for="paBldType3">AB</label>
										</span>
										<span>
											<input type="radio" id="paBldType4" name="paBldType" class="form-check-input" value="O" required/>
											<label for="paBldType4">O</label>
										</span>
									</div>
								</div>
							</div>
							
							
							
							<div class="dduk-row">
								<div class="dduk-login-d">
									<div class="login-input-label">보험 여부</div>
									<div class="form-check" role="group">
										<span>
											<input type="radio" id="paInsrYn1" name="paInsrYn" class="form-check-input" value="ISYN01" required />
											<label for="paInsrYn1">O</label>
										</span>
										<span>
											<input type="radio" id="paInsrYn2" name="paInsrYn" class="form-check-input" value="ISYN02" required/>
											<label for="paInsrYn2">X</label>
										</span>
									</div>
								</div>
							</div>
				</div>
			</form>
	      </div>
	      
	      <div class="modal-footer">
	        <button type="button" id="btnAddPatient" class="dduk-btn-active">저장</button>
	        <button type="button" class="dduk-btn-normal" data-bs-dismiss="modal">취소</button>
	      </div>
	    </div>
	  </div>
	</div>
</html>